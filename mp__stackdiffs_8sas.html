<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- HTML header for doxygen 1.8.17-->
<html xmlns="https://www.w3.org/1999/xhtml" lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=9" />
  <meta property="og:type" content="website">
  <meta property="og:title" content="MacroCore" />
  <meta property="og:url" content="https://core.sasjs.io" />
  <meta property="og:image" content="https://core.sasjs.io/Macro_core_website_1.png" />
  <meta name="author" content="Allan Bowe">
  <meta name="generator" content="Doxygen 1.9.2" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Macros for SAS Application Developers" />
  <meta name="og:description" content="Macros for SAS Application Developers" />
  <link href="tabs.css" rel="stylesheet" type="text/css" />
  <script type="text/javascript" src="jquery.js"></script>
  <script type="text/javascript" src="dynsections.js"></script>
  <link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
 <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
  <link href="doxygen.css" rel="stylesheet" type="text/css" />
  <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
  <link href="new_stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
  <div id="top">
    <!-- do not remove this div, it is closed by doxygen! -->
    <div id="titlearea">
      <table cellspacing="0" cellpadding="0">
        <tbody>
          <tr style="height: 56px">
            <td id="projectlogo">
              <a href=""><img alt="Logo" src="Macro_core_website_1.png" /></a>
            </td>
            <td id="projectalign" style="padding-left: 0.5em">
              <div id="projectbrief">
                Macros for SAS Application Developers<br />
                <a href="https://github.com/sasjs/core">
                  https://github.com/sasjs/core
                </a>
              </div>
            </td>
          </tr>
      </table>
      </td>
      </tr>
      </tbody>
      </table>
    </div>
    <!-- end header part -->
  </div>
</body>
</html><!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('mp__stackdiffs_8sas.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle"><div class="title">mp_stackdiffs.sas File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Prepares an audit table for stacking (re-applying) the changes.  
<a href="#details">More...</a></p>

<p><a href="mp__stackdiffs_8sas_source.html">Go to the source code of this file.</a></p>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p >When a Base Table is refreshed, it can be helpful to have any subsequent changes re-applied. This macro is used to convert stored changes (tall format) into staged changes (wide format), with base table values incorporated, ready for loading.</p>
<p >The rules for stacking changes are as follows:</p>
<p >Deleted Rows** These are marked for deletion once more. This is done by setting &amp;DELETE_COL to "Yes".</p>
<p >Inserted Rows** These are re-inserted, or - if the row now exists on the base table - the row is modified (only changed cells are applied)</p>
<p >Modified Rows** In this case, where the row exists, only the <em>previously</em> modified cell values are applied. If the row no longer exists in the base table, the row is inserted.</p>
<p >The audit table is assumed to be structured as per the <a class="el" href="mp__storediffs_8sas.html" title="Converts deletes/changes/appends into a single audit table.">mp_storediffs.sas</a> macro.</p>
<p >This macro supports both SCD2 (TXTEMPORAL) and UPDATE loadtypes. If the base table contains a PROCESSED_DTTM column (or similar), this can be ignored by declaring it in the <code>processed_dttm_var</code> parameter.</p>
<p >Usage: </p><pre class="fragment">data work.orig work.deleted work.changed work.appended;
  set sashelp.class;
  if _n_=1 then do;
    output work.orig work.deleted;
  end;
  else if _n_=2 then do;
    output work.orig;
    age=99;
    output work.changed;
  end;
  else do;
    name='Newbie';
    output work.appended;
    stop;
  end;
run;

%mp_storediffs(sashelp.class,work.orig,NAME
  ,delds=work.deleted
  ,modds=work.changed
  ,appds=work.appended
  ,outds=work.final
  ,mdebug=1
)
</pre> <dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">baselibds</td><td>Target table against which the changes will be applied, in libref.dataset format. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">auditlibds</td><td>Dataset with previously applied transactions, to be re-applied. Use libref.dataset format. DDL as follows: mp_coretable(DIFFTABLE) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">key</td><td>Space seperated list of key variables </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">delete_col=</td><td>(_____DELETE__THIS__RECORD_____) Variable name used to mark the row as being deleted</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">outds=</td><td>(work.mp_stackdiffs) Output table containing staged data to be re-applied.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">processed_dttm_var=</td><td>(0) If a variable is being used to mark the processed datetime, put the name of the variable here. It will NOT be included in the staged dataset (the load process is expected to provide this) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">mdebug=</td><td>set to 1 to enable DEBUG messages and preserve outputs</td></tr>
  </table>
  </dd>
</dl>
<h4>SAS Macros </h4>
<ul>
<li><a class="el" href="mf__getquotedstr_8sas.html" title="Adds custom quotes / delimiters to a delimited string.">mf_getquotedstr.sas</a> </li>
<li><a class="el" href="mf__getuniquename_8sas.html" title="Returns a shortened (32 char) GUID as a valid SAS name.">mf_getuniquename.sas</a> </li>
<li><a class="el" href="mf__getvarlist_8sas.html" title="Returns dataset variable list direct from header.">mf_getvarlist.sas</a></li>
</ul>
<h4>Related Macros </h4>
<ul>
<li><a class="el" href="mp__coretable_8sas.html" title="Create the permanent Core tables.">mp_coretable.sas</a> </li>
<li><a class="el" href="mp__storediffs_8sas.html" title="Converts deletes/changes/appends into a single audit table.">mp_storediffs.sas</a></li>
</ul>
<dl class="section version"><dt>Version</dt><dd>9.2 </dd></dl>
<dl class="section author"><dt>Author</dt><dd>Allan Bowe </dd></dl>

<p class="definition">Definition in file <a class="el" href="mp__stackdiffs_8sas_source.html">mp_stackdiffs.sas</a>.</p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.17-->
<!-- start footer part -->
<div id="nav-path" class="navpath">
  <!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_e914ee4d4a44400f1fdb170cb4ead18a.html">base</a></li><li class="navelem"><a class="el" href="mp__stackdiffs_8sas.html">mp_stackdiffs.sas</a></li>
    <li class="footer">
      Generated by
      <a href="https://www.doxygen.org/index.html">
        <img class="footer" src="doxygen.svg" alt="doxygen"
      /></a>
      1.9.2
    </li>
    <li>
      <i> For more information visit the </i>
      <a href="https://github.com/sasjs/core">Macro Core library</a>.
    </li>
  </ul>
</div>
